name: Update Contributors List

on:
  workflow_dispatch: # Allows you to run this workflow manually from the Actions tab
  schedule:
    - cron: '0 2 * * 0' # Runs at 2:00 AM UTC every Sunday

jobs:
  update-contributors:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0 # Fetches all commit history to find all contributors

      - name: Generate Contributors File
        run: |
          echo "# âœ¨ Our Contributors" > CONTRIBUTORS.md
          echo "" >> CONTRIBUTORS.md
          echo "A huge thank you to all the amazing people who have contributed to this project!" >> CONTRIBUTORS.md
          echo "" >> CONTRIBUTORS.md
          
          # List all authors (name and email), sort them, and remove duplicates
          git log --all --format='- %aN <%aE>' | sort -u >> CONTRIBUTORS.md
          
          echo "" >> CONTRIBUTORS.md
          echo "(This file is auto-generated by the [update-contributors](.github/workflows/uptcontri.yml) workflow.)" >> CONTRIBUTORS.md

      - name: Commit and Push Changes
        run: |
          git config --global user.name 'GitHub Actions Bot'
          git config --global user.email 'github-actions[bot]@users.noreply.github.com'
          
          # Add the new file to staging
          git add CONTRIBUTORS.md
          
          # Check if there are any changes to commit
          if git diff --staged --quiet; then
            echo "âœ… Contributors list is already up-to-date. No changes to commit."
          else
            echo "ðŸš€ New contributors found! Committing and pushing changes..."
            git commit -m "docs: Update CONTRIBUTORS.md"
            git push
          fi
