<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>InkFlow | Hand drawn Sketch look & feel</title>
    <!-- Added Ionicons for icons -->
    <script type="module" src="https://cdn.jsdelivr.net/npm/ionicons@latest/dist/ionicons/ionicons.esm.js"></script>
    <script nomodule src="https://cdn.jsdelivr.net/npm/ionicons@latest/dist/ionicons/ionicons.js"></script>
    <!-- Added Font Awesome for icons -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
    <!-- Added Bootstrap for styling -->
    <link href="Icons/bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <!-- Added Bootstrap Icons for icons -->
    <link href="Icons/bootstrap-icons/bootstrap-icons.css" rel="stylesheet">
    <!-- Added favicon for the website -->
    <link rel="icon" href="Images/InkFlow.png" type="image/png">
    <!-- Added custom stylesheet -->
    <link rel="stylesheet" href="Sketch.css">
    <style>
        /* Global Styles */
        body,
        html {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            font-family: Arial, sans-serif;
            background-color: #121212;

        }


        /* Canvas Styles */
        #canvas {
            background-color: #121212;
            cursor: crosshair;
        }

        /* Toolbar Styles */
        .toolbar {
            position: fixed;
            top: 15px;
            background-color: #232329;
            backdrop-filter: blur(10px);
            border-radius: 10px;
            padding: 5px 15px;
            display: flex;
            gap: 13px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
            transition: all 0.3s ease, transform 0.3s ease;
            z-index: 1000;
        }

        /* Main Toolbar Positioning */
        #main-toolbar {
            left: 50%;
            transform: translateX(-50%);
        }

        /* Secondary Toolbar Positioning */
        #sidebarmenu {
            right: 20px;
        }

        #undoredo {
            left: 20px;
            position: fixed;
            top: 95%;
            transform: translateY(-50%);
            display: flex;
        }

        #delete {
            position: fixed;
            top: 95%;
            left: 155px;
            transform: translateY(-50%);
            display: flex;
        }

        /* Zoom Toolbar Styles */
        #zoom-toolbar {
            position: fixed;
            top: 95%;
            right: 20px;
            transform: translateY(-50%);
            display: flex;
        }

        #lock-bar {
            left: 20px;
            position: fixed;
            display: flex;

        }

        /* Tool Styles */
        .tool {
            width: 40px;
            height: 40px;
            border: none;
            background-color: transparent;
            color: #fff;
            border-radius: 30%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 17px;
            transition: all 0.3s ease, transform 0.3s ease;
        }

        /* Tool Hover Styles */
        .tool:hover {
            background-color: #31303B;
            transform: translateY(-5px) scale(1.1);
        }

        /* Tool Active Styles */
        .tool.active {
            background-color: #403E6A;
        }

        /* Color Picker Styles */
        #colorPicker {
            width: 40px;
            height: 40px;
            padding: 0;
            border: none;
            border-radius: 50%;
            cursor: pointer;
            overflow: hidden;
            transition: all 0.3s ease;
        }

        /* Color Picker Hover Styles */
        #colorPicker:hover {
            transform: scale(1.1);
        }

        /* Color Picker Webkit Styles */
        #colorPicker::-webkit-color-swatch-wrapper {
            padding: 0;
        }

        #colorPicker::-webkit-color-swatch {
            border: none;
            border-radius: 50%;
        }

        /* Angle Info Styles */
        #angleInfo {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background-color: #232329;
            color: white;
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 15px;
            display: none;
            transition: all 0.3s ease;
        }

        @media (max-width: 797px) {
            .toolbar {
                display: flex;
                justify-content: center;
                align-items: center;
                padding: 5px 15px;
                gap: 14px;
            }

            #sidebarmenu {
                position: fixed;
                height: 40px;
                width: 40px;
                left: 166px;
                top: 95%;
                transform: translateY(-50%);
                flex-direction: row;
                display: flex;
            }

            #undoredo {
                position: fixed;
                top: 95%;
                transform: translateY(-50%);
                display: flex;
                flex-direction: row;
                padding: 5px 8px;
            }

            #delete {
                position: fixed;
                top: 95%;
                left: 115px;
                transform: translateY(-50%);
                display: flex;
                flex-direction: row;
                padding: 5px 8px;
            }

            #lock-bar {
                top: 95%;
                left: 462px;
                position: fixed;
                display: flex;
                flex-direction: row;
                transform: translateY(-50%);
                padding: 5px 8px;
            }

            .tool {
                width: 30px;
                height: 30px;
                font-size: 15px;
            }

            #colorPicker {
                width: 30px;
                height: 30px;
            }
        }

        @media (max-width: 414px) {
            .toolbar {
                display: flex;
                justify-content: center;
                align-items: center;
                padding: 5px 8px;
                gap: 10px;
            }

            #sidebarmenu {
                position: fixed;
                height: 40px;
                width: 40px;
                left: 166px;
                top: 95%;
                transform: translateY(-50%);
                flex-direction: row;
                display: flex;
            }

            #undoredo {
                position: fixed;
                top: 95%;
                transform: translateY(-50%);
                display: flex;
                flex-direction: row;
                padding: 5px 8px;
            }

            #delete {
                position: fixed;
                top: 95%;
                left: 113px;
                transform: translateY(-50%);
                display: flex;
                flex-direction: row;
                padding: 5px 8px;
            }

            /* #lock-bar {
        top: 95%;
        left: 462px;
        position: fixed;
        display: flex;
        flex-direction: row;
        transform: translateY(-50%);
        padding: 5px 8px;
    } */

            .tool {
                width: 30px;
                height: 30px;
                font-size: 12.1px;
            }

            #colorPicker {
                width: 25px;
                height: 25px;
            }
        }
    </style>
</head>

<body>
    <canvas id="canvas"></canvas>
    <div id="main-toolbar" class="toolbar">
        <button class="tool" id="select" title="Select/Pan"><ion-icon name="hand-right-outline"></ion-icon></button>
        <button class="tool" id="pointer" title="Pointer"><i class="bi bi-cursor"
                style="transform: rotate(290deg);"></i></button>
        <button class="tool" id="rectangle" title="Rectangle"><i class="far fa-square"></i></button>
        <button class="tool" id="circle" title="Circle"><i class="far fa-circle"></i></button>
        <button class="tool" id="triangle" title="Triangle"><ion-icon name="triangle-outline"></ion-icon></button>
        <button class="tool" id="line" title="Line"><i class="bi bi-dash-lg"></i></button>
        <button class="tool" id="arrow" title="Arrow"><i class="bi bi-arrow-right"></i></button>
        <button class="tool active" id="pencil" title="Pencil"><i class="fas fa-pencil-alt"></i></button>
        <button class="tool" id="text" title="Text"><i class="fas fa-font"></i></button>
        <button class="tool" id="eraser" title="Eraser"><i class="bi bi-eraser"></i></button>
        <input type="color" id="colorPicker" value="#ffffff" title="Color Picker">
        <div id="instructions"
            style="color: #d6d4d4; position: absolute; top: 70px; width: 100%; font-size:small; text-align: center;">
            Click & drag, release when you're finished</div>
    </div>
    <div id="sidebarmenu" class="toolbar">
        <button class="tool" id="sidebar" title="Open Sidebar"><ion-icon name="grid-outline"></ion-icon></button>
    </div>
    <div id="undoredo" class="toolbar">
        <button class="tool" id="undo" title="Undo"><i class="fas fa-undo"></i></button>
        <button class="tool" id="redo" title="Redo"><i class="fas fa-redo"></i></button>
    </div>
    <div id="delete" class="toolbar">
        <button class="tool" id="clear" title="Clear All"><i class="fas fa-trash-alt"></i></button>
    </div>
    <div id="zoom-toolbar" class="toolbar">
        <button class="tool" id="zoom-in" title="Zoom In"><i class="fas fa-search-plus"></i></button>
        <button class="tool" id="zoom-out" title="Zoom Out"><i class="fas fa-search-minus"></i></button>
    </div>
    <div id="lock-bar" class="toolbar">
        <button class="tool" id="lock" title="Lock/Unlock"><ion-icon name="lock-closed"></ion-icon></button>
    </div>
    <div id="angleInfo"></div>
    <!-- Added Bootstrap JavaScript for functionality -->
    <script src="Icons/bootstrap/js/bootstrap.bundle.min.js"></script>
    <!-- Added Rough.js for drawing -->
    <script src="https://unpkg.com/roughjs@latest/bundled/rough.js"></script>
    <!-- Added custom JavaScript -->
    <script src="Sketch.js"></script>
    <script>

        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        const rc = rough.canvas(canvas);
        const angleInfo = document.getElementById('angleInfo');
        let isDrawing = false;
        let lastX = 0;
        let lastY = 0;
        let elements = [];
        let selectedTool = 'pencil';
        let selectedColor = '#ffffff';
        let currentElement = null;
        let undoStack = [];
        let redoStack = [];
        let isPanning = false;
        let panStartX = 0;
        let panStartY = 0;

        function resizeCanvas() {
            canvas.width = window.innerWidth * 2;
            canvas.height = window.innerHeight * 2;
            canvas.style.width = `${window.innerWidth}px`;
            canvas.style.height = `${window.innerHeight}px`;
            ctx.scale(2, 2);
            redrawCanvas();
        }

        window.addEventListener('resize', resizeCanvas);

        document.querySelectorAll('.tool').forEach(tool => {
            tool.addEventListener('click', () => {
                if (tool.id === 'clear') {
                    elements = [];
                    redrawCanvas();
                } else if (tool.id === 'undo') {
                    undo();
                } else if (tool.id === 'redo') {
                    redo();
                } else if (tool.id === 'select') {
                    selectedTool = 'select';
                    tool.classList.add('active'); // Keep the select tool active
                } else {
                    document.querySelector('.tool.active').classList.remove('active');
                    tool.classList.add('active');
                    selectedTool = tool.id;
                }
            });
        });

        document.getElementById('colorPicker').addEventListener('input', (e) => {
            selectedColor = e.target.value;
        });

        canvas.addEventListener('mousedown', (e) => {
            if (selectedTool === 'select') {
                isPanning = true;
                panStartX = e.offsetX;
                panStartY = e.offsetY;
                document.getElementById('select').classList.add('active'); // Keep the select tool active while panning
            } else {
                startDrawing(e);
            }
        });

        canvas.addEventListener('mousemove', (e) => {
            if (isPanning) {
                const panEndX = e.offsetX;
                const panEndY = e.offsetY;
                const deltaX = panEndX - panStartX;
                const deltaY = panEndY - panStartY;
                elements.forEach(element => {
                    switch (element.type) {
                        case 'pencil':
                            element.x1 += deltaX;
                            element.y1 += deltaY;
                            element.x2 += deltaX;
                            element.y2 += deltaY;
                            break;
                        case 'arrow':
                        case 'line':
                        case 'rectangle':
                        case 'circle':
                        case 'triangle':
                            element.x1 += deltaX;
                            element.y1 += deltaY;
                            element.x2 += deltaX;
                            element.y2 += deltaY;
                            break;
                    }
                });
                redrawCanvas();
                panStartX = panEndX;
                panStartY = panEndY;
            } else {
                draw(e);
            }
        });

        canvas.addEventListener('mouseup', () => {
            isPanning = false;
            stopDrawing();
            document.getElementById('select').classList.remove('active'); // Remove the active class when panning ends
        });

        function startDrawing(e) {
            isDrawing = true;
            [lastX, lastY] = [e.offsetX, e.offsetY];
            currentElement = { type: selectedTool, x1: lastX, y1: lastY, color: selectedColor };
        }

        function draw(e) {
            if (!isDrawing) return;

            const currentX = e.offsetX;
            const currentY = e.offsetY;

            if (selectedTool === 'pencil') {
                elements.push({ type: 'pencil', x1: lastX, y1: lastY, x2: currentX, y2: currentY, color: selectedColor });
                [lastX, lastY] = [currentX, currentY];
            } else if (selectedTool === 'arrow') {
                currentElement.x2 = currentX;
                currentElement.y2 = currentY;
            } else if (selectedTool === 'eraser') {
                eraseAt(currentX, currentY);
            } else {
                currentElement.x2 = currentX;
                currentElement.y2 = currentY;
            }

            if (selectedTool === 'line' || selectedTool === 'arrow') {
                showAngle(lastX, lastY, currentX, currentY);
            }

            redrawCanvas();
        }

        function stopDrawing() {
            if (!isDrawing) return;
            isDrawing = false;
            angleInfo.style.display = 'none';

            if (selectedTool !== 'pencil' && selectedTool !== 'eraser') {
                elements.push(currentElement);
            }
            currentElement = null;
            saveState();
            redrawCanvas();
        }

        function redrawCanvas() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            elements.forEach(element => drawElement(element));
            if (currentElement) drawElement(currentElement);
        }

        function drawElement(element) {
            switch (element.type) {
                case 'pencil':
                    rc.line(element.x1, element.y1, element.x2, element.y2, { stroke: element.color, roughness: 0, strokeWidth: 2 });
                    break;
                case 'arrow':
                    drawArrow(element.x1, element.y1, element.x2, element.y2, element.color);
                    break;
                case 'line':
                    rc.line(element.x1, element.y1, element.x2, element.y2, { stroke: element.color });
                    break;
                case 'rectangle':
                    rc.rectangle(element.x1, element.y1, element.x2 - element.x1, element.y2 - element.y1, { stroke: element.color });
                    break;
                case 'circle':
                    const width = element.x2 - element.x1;
                    const height = element.y2 - element.y1;
                    const diameter = Math.max(Math.abs(width), Math.abs(height));
                    rc.circle(element.x1 + width / 2, element.y1 + height / 2, diameter, { stroke: element.color });
                    break;
                case 'triangle':
                    rc.path(`M ${element.x1} ${element.y2} L ${element.x2} ${element.y2} L ${(element.x1 + element.x2) / 2} ${element.y1} Z`, { stroke: element.color });
                    break;
            }
        }

        function drawArrow(x1, y1, x2, y2, color) {
            const headLength = 15;
            const angle = Math.atan2(y2 - y1, x2 - x1);

            rc.line(x1, y1, x2, y2, { stroke: color });

            const arrowX1 = x2 - headLength * Math.cos(angle - Math.PI / 6);
            const arrowY1 = y2 - headLength * Math.sin(angle - Math.PI / 6);

            const arrowX2 = x2 - headLength * Math.cos(angle + Math.PI / 6);
            const arrowY2 = y2 - headLength * Math.sin(angle + Math.PI / 6);

            rc.line(x2, y2, arrowX1, arrowY1, { stroke: color });
            rc.line(x2, y2, arrowX2, arrowY2, { stroke: color });
        }

        function showAngle(x1, y1, x2, y2) {
            const dx = x2 - x1;
            const dy = y2 - y1;
            let angle = Math.atan2(dy, dx) * 180 / Math.PI;
            angle = (angle + 360) % 360;
            angleInfo.textContent = `Angle: ${angle.toFixed(1)}°`;
            angleInfo.style.display = 'block';
        }

        function eraseAt(x, y) {
            const eraserRadius = 10;
            elements = elements.filter(element => {
                if (element.type === 'pencil') {
                    const distance = Math.sqrt(Math.pow((element.x1 + element.x2) / 2 - x, 2) + Math.pow((element.y1 + element.y2) / 2 - y, 2));
                    return distance > eraserRadius;
                } else {
                    const centerX = (element.x1 + element.x2) / 2;
                    const centerY = (element.y1 + element.y2) / 2;
                    const distance = Math.sqrt(Math.pow(centerX - x, 2) + Math.pow(centerY - y, 2));
                    return distance > eraserRadius;
                }
            });
        }

        function saveState() {
            undoStack.push([...elements]);
            redoStack = [];
        }

        function undo() {
            if (undoStack.length > 0) {
                redoStack.push([...elements]);
                elements = undoStack.pop();
                redrawCanvas();
            }
        }

        function redo() {
            if (redoStack.length > 0) {
                undoStack.push([...elements]);
                elements = redoStack.pop();
                redrawCanvas();
            }
        }
        resizeCanvas();


    </script>
</body>

</html>